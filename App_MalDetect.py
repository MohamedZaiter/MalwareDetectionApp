import streamlit as st
import pandas as pd
import numpy as np

st.title("Malware Detection Using Machine Learning ")

# Chargement du fichier
uploaded_file = st.file_uploader("Téléchargez votre dataset (CSV uniquement)", type="csv")

if uploaded_file:
    # Lecture et prévisualisation du dataset
    df = pd.read_csv(uploaded_file)
    st.write("Aperçu du dataset :")
    st.dataframe(df.head())
    st.write(f"Dimensions du dataset : {df.shape[0]} lignes et {df.shape[1]} colonnes")
    
    # Sélection des colonnes
    selected_columns = st.multiselect(
        "Sélectionnez les colonnes pertinentes pour l'analyse",
        options=df.columns.tolist(),
    )
    
    if selected_columns:
        st.write("Colonnes sélectionnées :", selected_columns)
        df_selected = df[selected_columns]
        
        # Simulation de prédictions
        st.write("Application du modèle...")
        df_selected["Prediction"] = np.random.choice(["Malware", "Sain"], size=len(df_selected))
        df_selected["Score"] = np.random.uniform(0, 1, size=len(df_selected))
        
        # Affichage des résultats
        st.write("Résultats :")
        st.dataframe(df_selected.head())
        
        # Visualisation
        st.subheader("Distribution des prédictions")
        st.bar_chart(df_selected["Prediction"].value_counts())
        
        # Téléchargement des résultats
        st.write("Téléchargez les résultats enrichis avec les prédictions")
        csv = df_selected.to_csv(index=False).encode("utf-8")
        st.download_button(
            "Télécharger le fichier CSV",
            data=csv,
            file_name="predictions_malware.csv",
            mime="text/csv",
        )
